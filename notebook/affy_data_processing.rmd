---
title: Processing Affymetrix Microarrays
output: 
    html_document:
        code_folding: show
params:
    test_value: 10
---

### Import Packages
```{r}
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("oligo")
#package for reading CEL files, will add more packages for further steps
```
### Import Raw Data
```{r}
csv_file <- read.table(file = r"(C:\Users\linde\rmarkdown\affy_processing\data_runsheets\GLDS_6_runsheet.csv)", 
                       sep=",",
                       header = TRUE,
                       check.names = FALSE
                       )
array_data_files <- csv_file["Path to Raw Data File"] #column name of paths

raw_data <- oligo::read.celfiles(array_data_files) #AffyBatch Class
```

### Verify Data
```{r}
print("Verify Data step")
```

### Quality Analysis 
### QA: Visualization
```{r}
density_plot = hist(raw_data, transfo=log2, which=c("pm", "mm", "bg", "both", "all"),
                    nsample=10000, target = "core", main = "Density Plot")
```
# transfo : used to scale the data
# which : defines specific probe types
# nsample : sample size used to produce plot
# target : specifies group of meta-probeset
# main : main title 
```{r}
pseudoimage = image(raw_data, transfo=log2)
```
```{r}
MA_plot = MAplot(raw_data)
```
### QA: Statistics
```{r}
BiocManager::install("AnnotationDbi")
BiocManager::install("Biobase")
```
### IQRray
```{r}
# The IQRray statistic is obtained by ranking all the probe intensities from
# a given array and by computing the average rank for each probe set. The
# interquartile range (IQR) of the probe sets average ranks serves then as
# quality score. 
#Example of a low score: 122783.6
#   high score: 226124.6
library(methods)
library(AnnotationDbi)
library(Biobase)

	#data - Affybatch object obtained after reading in celfiles into R with function ReadAffy from package affy
	
	#obtaining intensity values for perfect match (pm) probes
pm_data<-pm(raw_data)
	
	#ranking probe intensities for every array 
rank_data<-apply(pm_data,2,rank)
	
	#obtaining names of probeset for every probe
probeNames<-probeNames(raw_data)
	
	#function computing IQR of mean probe ranks in probesets 
get_IQR<-function(rank_data,probeNames){round(IQR(sapply(split(rank_data,probeNames),mean)),digits=2)}
	
	#computing arIQR score
IQRray_score<-apply(rank_data,2,get_IQR,probeNames=probeNames)	

```

### Normalize Data
```{r}
print("Normalize Data step")
```
### Verify Normalization
```{r}
print("Verify Normalization step")
```
### DGE Analysis
```{r}
print("DGE Analysis step")
```
### Gene Annotations
```{r}
print("Gene Annotations step")
```